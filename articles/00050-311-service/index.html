<!DOCTYPE html>
<!--[if IE 8]> <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js fonts-loading" lang="en">
  <!--<![endif]-->
  <head>
    
		
    <meta name="google-site-verification" content="2x-m6YWKWDDetUhM65F7bxdb712LsNntIQKyI2tL-iQ" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link rel="alternate" type="application/rss+xml" title="The Luckyrandom's blog" href="http://blog.luckyrandom.com/feed.xml" />
    
		
                <meta property="og:title" content="Big data analytics with dplyr and SQLite">
		<meta property="og:site_name" content="">
		<meta property="og:type" content="blog">
		<meta property="og:description" content="">

    <link rel="canonical" href="http://blog.luckyrandom.com/articles/00050-311-service/"/>
    <title>Big data analytics with dplyr and SQLite - blog.luckyrandom.com</title>
    <link rel="stylesheet" href="/css/main.css" type="text/css">
    <link rel="stylesheet" href="/highlight/styles/tomorrow.css">
    <script src="/highlight/highlight.pack.js"></script>
    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="/javascript/highlight-pandoc.js"></script>
    
  </head>
  <body>
    <header class="header">
      <div class="content-wrap">
        
        <div class="logo">
          <h1>
            <a href=/>
              The Luckyrandom's blog
            </a>
        </div>
        <p class="description"> I enjoy thinking; I know statistics; I can code. </p>
        
    </header>
    <div id="content">
      <div class="content-wrap">
        
		<div class="row">
			<div class="twelve columns">
				<div class="article">
                                  <h1 class="title">Big data analytics with dplyr and SQLite</h1>
                                  <div class="post-date">2015-04-29</div>

                                  <div class="share-button">
                                    <!-- twitter share button -->
                                    <a href="https://twitter.com/share" class="twitter-share-button" data-via="luckyrand" data-text = "Big data analytics with dplyr and SQLite">Tweet</a>
                                    <script>window.twttr = (function(d, s, id) {
                                      var js, fjs = d.getElementsByTagName(s)[0],
                                      t = window.twttr || {};
                                      if (d.getElementById(id)) return t;
                                      js = d.createElement(s);
                                      js.id = id;
                                      js.src = "https://platform.twitter.com/widgets.js";
                                      fjs.parentNode.insertBefore(js, fjs);

                                      t._e = [];
                                      t.ready = function(f) {
                                      t._e.push(f);
                                      };

                                      return t;
                                      }(document, "script", "twitter-wjs"));</script>
                                  </div>
                                  
                                  
					<h1 class="subtitle">Reimplement analytics of NYC 311 service data in R</h1>
					
					<style type="text/css">
div.code_chunk {
border-left: rgb(123, 218, 123);
border-left-width: thick;
border-left-style: solid;
}

pre.time {
display: block;b
padding-right: 1ex;
Background-color: rgb(123, 218, 123);
padding: 0.2em;
margin-left: 0em;
margin-bottom: 0em;
border: none;
border-radius: initial;
color: rgba(255, 255, 255, 0.75);
font-size: 0.6em;
}
</style>
<p><strong>The rmd source file is available on <a href="https://github.com/luckyrandom/blog/tree/source/contents/articles/00050-311-service/311service.Rmd">github</a>.</strong></p>
<h1 id="summary">Summary</h1>
<p>This is a long post. I put my thought about this project in the beginning, so you can skip all the details.</p>
<ul>
<li>In memory implementation is in general faster than database. If your data is not that big, try in memory implementation.</li>
<li>The dplyr wrap makes it easy to switch from one implementation to another, though it is not effortless.</li>
<li>Be careful with unusual values. “00:00:00” may mean NA.</li>
<li>Choose an informative plot.</li>
</ul>
<h1 id="introduction">Introduction</h1>
<p>The article <a href="https://plot.ly/ipython-notebooks/big-data-analytics-with-pandas-and-sqlite/#A-Large-Data-Workflow-with-Pandas">Big data analytics with Pandas and SQLite</a> on <a href="https://plot.ly/">plot.ly</a> demonstrates a large data workflow with Pandas, Python and SQLite. As suggested by <a href="https://twitter.com/hadleywickham">Hadley Wickham</a> on <a href="https://twitter.com/hadleywickham/status/586946466570047488">twitter</a>, this post reimplements it in R for comparison. It may not be a fair comparison, since reimplement is easier than original analysis. This post owes a debt of gratitude to the <a href="https://plot.ly/ipython-notebooks/big-data-analytics-with-pandas-and-sqlite/#A-Large-Data-Workflow-with-Pandas">original post</a> for its great analysis.</p>
<p>The data file is composed of about 9.1 million rows of data (a diiferent size from the post on plot.ly, since the size increases everyday), containing NYC’s 311 complaints since 2003. The data file is too large to track in git, and can be download from <a href="https://nycopendata.socrata.com/Social-Services/311-Service-Requests-from-2010-to-Present/erm2-nwe9">NYC’s open data portal</a>.</p>
<p>The original article performs out-of-memory aggregations with SQLite, since the dataset is too large to load into a Pandas dataframe. However, the few columns we are interested in can be loaded in memory easily. This post compares three different implementation in R</p>
<ul>
<li>dplyr wrap of in memory data.frame</li>
<li>dplyr wrap of SQLite database</li>
<li>SQL command with SQLite database</li>
</ul>
<p>Functions from <code>dplyr</code> and pipe function <code>%&gt;%</code> are heavily used in this post. Listed below are a few references about them.</p>
<ul>
<li><a href="http://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html">Vignette about <code>%&gt;%</code> and <code>%T&gt;%</code></a></li>
<li><a href="http://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html">Introduction to dplyr</a></li>
<li><a href="http://cran.rstudio.com/web/packages/dplyr/vignettes/new-sql-backend.html">Introduction to dplyr SQL backend</a></li>
</ul>
<p>The code of the first half of post is direct translation of the Python code from the original post, and the SQL code is mostly copied from original post. The second half, starting from section about plot, is more or less different from the original post for two reasons.</p>
<p>Firstly, the original post use interactive plot heavily by <a href="https://plot.ly/">plot.ly</a>, but it’s not easy to draw active plot in R (which indeed means I’m not good at it in R).</p>
<p>Secondly and more importantly, I hold a different opinion about some of the plots. Although the interactive plots are cool, the information included is too dense to be useful. You can hover mouse on the plot to get detail information, but you don’t know where to hover when the plot include more than hundreds of columns or rows of data. Instead, the plots in this posts focus on top values. Also, some of the bar charts are replaced by dots plots and heat plots when they are more informative.</p>
<p>This post is written in <code>rmarkdown</code> and rendered by <a href="http://yihui.name/knitr/">knitr</a> and <a href="http://pandoc.org/">pandoc</a>, or can be rendered by <a href="http://rmarkdown.rstudio.com/">R Markdown v2</a>, if you prefer. The CPU time is measured with some special hook of knitr, and reported both as number and color of header of each chunk, with red representing long run time. Please check the source code if you are interested in the implementation.</p>
<h2 id="load-dataset">Load dataset</h2>
<div class="code_chunk">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## load R packages
<span class="kw">library</span>(readr)
<span class="kw">library</span>(plyr)
<span class="kw">library</span>(dplyr)</code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;
## 
## The following objects are masked from &#39;package:plyr&#39;:
## 
##     arrange, count, desc, failwith, id, mutate, rename, summarise,
##     summarize
## 
## The following object is masked from &#39;package:stats&#39;:
## 
##     filter
## 
## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(scales)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(DBI)
<span class="kw">library</span>(grid)
<span class="kw">theme_update</span>(<span class="dt">plot.background =</span> <span class="kw">element_blank</span>(),
             <span class="dt">legend.background =</span> <span class="kw">element_blank</span>())</code></pre></div>
</div>
<p>Load a few lines to check the structure.</p>
<div class="code_chunk">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Data file is stored in sub-directory `noshare`
file_311 &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="st">&quot;noshare&quot;</span>,
                      <span class="st">&quot;311_Service_Requests_from_2010_to_Present.csv&quot;</span>)
(head_service &lt;-<span class="st"> </span><span class="kw">read_csv</span>(file_311, <span class="dt">n_max =</span> <span class="dv">100</span>))</code></pre></div>
<pre><code>## Source: local data frame [100 x 52]
## 
##    Unique Key           Created Date            Closed Date Agency
## 1    30379793 04/12/2015 02:41:17 AM                           DOT
## 2    30378748 04/12/2015 02:08:53 AM 04/12/2015 02:09:52 AM    HRA
## 3    30380600 04/12/2015 02:08:40 AM                          NYPD
## 4    30378453 04/12/2015 02:08:24 AM                          NYPD
## 5    30381446 04/12/2015 02:04:39 AM                          NYPD
## 6    30378546 04/12/2015 02:01:31 AM 04/12/2015 02:47:01 AM   NYPD
## 7    30379756 04/12/2015 02:00:35 AM 04/12/2015 02:55:34 AM   NYPD
## 8    30377618 04/12/2015 01:59:14 AM                          NYPD
## 9    30378524 04/12/2015 01:58:18 AM 04/12/2015 01:58:41 AM    DHS
## 10   30382370 04/12/2015 01:57:05 AM                          NYPD
## ..        ...                    ...                    ...    ...
## Variables not shown: Agency Name (chr), Complaint Type (chr), Descriptor
##   (chr), Location Type (chr), Incident Zip (int), Incident Address (chr),
##   Street Name (chr), Cross Street 1 (chr), Cross Street 2 (chr),
##   Intersection Street 1 (chr), Intersection Street 2 (chr), Address Type
##   (chr), City (chr), Landmark (lgl), Facility Type (chr), Status (chr),
##   Due Date (chr), Resolution Action Updated Date (chr), Community Board
##   (chr), Borough (chr), X Coordinate (State Plane) (int), Y Coordinate
##   (State Plane) (int), Park Facility Name (chr), Park Borough (chr),
##   School Name (chr), School Number (chr), School Region (chr), School Code
##   (chr), School Phone Number (chr), School Address (chr), School City
##   (chr), School State (chr), School Zip (chr), School Not Found (chr),
##   School or Citywide Complaint (lgl), Vehicle Type (lgl), Taxi Company
##   Borough (lgl), Taxi Pick Up Location (chr), Bridge Highway Name (lgl),
##   Bridge Highway Direction (lgl), Road Ramp (lgl), Bridge Highway Segment
##   (lgl), Garage Lot Name (lgl), Ferry Direction (lgl), Ferry Terminal Name
##   (lgl), Latitude (dbl), Longitude (dbl), Location (chr)</code></pre>
</div>
<p>Load the columns we are interested in. Thanks to <code>readr</code>, the loading is pretty fast.</p>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(124, 217, 122)); /* Standard syntax; must be last */">user: 0.012 | system: 0.001 | elapsed: 0.012</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">load_columns &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Agency&#39;</span>, <span class="st">&#39;Created Date&#39;</span>, <span class="st">&#39;Closed Date&#39;</span>,
                  <span class="st">&#39;Complaint Type&#39;</span>, <span class="st">&#39;Descriptor&#39;</span>, <span class="st">&#39;City&#39;</span>)
col_types &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">list</span>(<span class="kw">col_skip</span>()), <span class="kw">length</span>(<span class="kw">colnames</span>(head_service)))
<span class="kw">names</span>(col_types) &lt;-<span class="st"> </span><span class="kw">colnames</span>(head_service)
col_types[load_columns] &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">list</span>(<span class="kw">col_character</span>()), <span class="dv">6</span>) </code></pre></div>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user:  82.88 | system:   8.53 | elapsed: 118.16</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(service_char &lt;-
<span class="st">    </span><span class="kw">read_delim</span>(file_311, <span class="dt">delim =</span> <span class="st">&quot;,&quot;</span>, <span class="dt">col_types =</span> col_types, <span class="dt">progress =</span> <span class="ot">FALSE</span>))</code></pre></div>
<pre><code>## 
|================================================================================| 100% 4420 MB</code></pre>
<pre><code>##    user  system elapsed 
##  82.834   8.526 118.111</code></pre>
</div>
<p>Change data types as needed.</p>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 233.79 | system:   9.06 | elapsed: 246.21</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## rm white space in column names 
<span class="kw">colnames</span>(service_char) &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">colnames</span>(service_char))
time_format &lt;-<span class="st"> &quot;%m/%d/%Y %I:%M:%S %p&quot;</span>
service &lt;-<span class="st"> </span><span class="kw">within</span>(service_char, {
                      Agency &lt;-<span class="st"> </span><span class="kw">as.factor</span>(Agency)
                      CreatedDate  &lt;-<span class="st">  </span><span class="kw">strftime</span>(<span class="kw">as.POSIXlt</span>(CreatedDate, <span class="dt">format =</span> time_format))
                      ClosedDate &lt;-<span class="st">  </span><span class="kw">strftime</span>(<span class="kw">as.POSIXlt</span>(ClosedDate, <span class="dt">format =</span> time_format))
                      ComplaintType  &lt;-<span class="st"> </span><span class="kw">as.factor</span>(ComplaintType)
                      City &lt;-<span class="st"> </span><span class="kw">as.factor</span>(City)
                  })
<span class="kw">print</span>(<span class="kw">object.size</span>(service), <span class="dt">units =</span> <span class="st">&quot;Mb&quot;</span>)</code></pre></div>
<pre><code>## 829.6 Mb</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(service_char)
<span class="kw">gc</span>()</code></pre></div>
<pre><code>##             used  (Mb) gc trigger   (Mb)  max used   (Mb)
## Ncells   7363033 393.3   41814278 2233.2  41615065 2222.5
## Vcells 102734572 783.9  517222059 3946.1 645682158 4926.2</code></pre>
</div>
<p>The size of object is about 1 Gb, which can be easily loaded in memory.</p>
<p>Check the loaded data.</p>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(124, 216, 122)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(124, 216, 122)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(124, 216, 122)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(124, 216, 122)); /* Standard syntax; must be last */">user: 0.012 | system: 0.002 | elapsed: 0.018</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service</code></pre></div>
<pre><code>## Source: local data frame [9,115,505 x 6]
## 
##            CreatedDate          ClosedDate Agency
## 1  2015-04-12 02:41:17                  NA    DOT
## 2  2015-04-12 02:08:53 2015-04-12 02:09:52    HRA
## 3  2015-04-12 02:08:40                  NA   NYPD
## 4  2015-04-12 02:08:24                  NA   NYPD
## 5  2015-04-12 02:04:39                  NA   NYPD
## 6  2015-04-12 02:01:31 2015-04-12 02:47:01   NYPD
## 7  2015-04-12 02:00:35 2015-04-12 02:55:34   NYPD
## 8  2015-04-12 01:59:14                  NA   NYPD
## 9  2015-04-12 01:58:18 2015-04-12 01:58:41    DHS
## 10 2015-04-12 01:57:05                  NA   NYPD
## ..                 ...                 ...    ...
## Variables not shown: ComplaintType (fctr), Descriptor (chr), City (fctr)</code></pre>
</div>
<p>Note that the dataset is printed neatly, without calling <code>head</code> function explicitly. The S3 class of <code>service</code> is <code>tbl_df</code>. According to the document, “The main advantage to using a ‘tbl_df’ over a regular data frame is the printing: tbl objects only print a few rows and all the columns that fit on one screen, describing the rest of it as text.”</p>
<p>Then we save the service table to SQLite database. If the data is larger, we may have to load and save by chunk, but I will cheat here by loading and saving the whole data, until <a href="https://github.com/hadley/readr">readr</a> provides better support for <a href="https://github.com/hadley/readr/issues/118">this feature</a>.</p>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(128, 210, 118)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(128, 210, 118)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(128, 210, 118)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(128, 210, 118)); /* Standard syntax; must be last */">user: 0.050 | system: 0.006 | elapsed: 0.075</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sql_file &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="st">&quot;noshare&quot;</span>, <span class="st">&quot;service.sqlite&quot;</span>)
if( !<span class="kw">file.exists</span>( sql_file ) ||
<span class="st">   </span><span class="kw">file.mtime</span>(file_311) &gt;<span class="st"> </span><span class="kw">file.mtime</span>( sql_file ) ) {
    db &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(RSQLite::<span class="kw">SQLite</span>(), sql_file)
    ## Temperary fix for issue https://github.com/rstats-db/RSQLite/issues/82
    <span class="kw">setOldClass</span>(<span class="kw">c</span>(<span class="st">&quot;tbl_df&quot;</span>, <span class="st">&quot;data.frame&quot;</span>))
    <span class="kw">dbWriteTable</span>(db, <span class="st">&quot;data&quot;</span>, service, <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">overwrite =</span> <span class="ot">FALSE</span>)
} else {
    db &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(RSQLite::<span class="kw">SQLite</span>(), sql_file)
}</code></pre></div>
</div>
<p>Create dplyr wrap of SQLite database.</p>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(125, 215, 121)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(125, 215, 121)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(125, 215, 121)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(125, 215, 121)); /* Standard syntax; must be last */">user: 0.019 | system: 0.002 | elapsed: 0.028</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_db &lt;-<span class="st"> </span><span class="kw">tbl</span>(<span class="kw">src_sqlite</span>(sql_file, <span class="dt">create =</span> <span class="ot">FALSE</span>), <span class="st">&quot;data&quot;</span>)</code></pre></div>
</div>
<p><code>service</code> is a dplyr wrap of in memory data.frame, and <code>service_db</code> is a dplyr wrap of the SQLite database. They share similar interfaces, and most functions that applied to one object can be applied to the other object without any change. <code>dplyr</code> translates the function calls applied to <code>service_db</code> to SQL command, which can be checked with function <code>explain</code>. The following function is defined to check the SQL command and then retrieve the value.</p>
<div class="code_chunk">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">explain_and_eval &lt;-<span class="st"> </span>function(x, ...) {
    <span class="kw">print</span>(<span class="kw">explain</span>(x, ...))
    x
}</code></pre></div>
</div>
<h1 id="preview-the-table">Preview the table</h1>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(123, 217, 123)); /* Standard syntax; must be last */">user: 0.006 | system: 0.000 | elapsed: 0.006</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dbGetQuery</span>(db, <span class="st">&#39;SELECT * FROM data LIMIT 3&#39;</span>)</code></pre></div>
<pre><code>##           CreatedDate          ClosedDate Agency            ComplaintType
## 1 2015-04-12 02:41:17                &lt;NA&gt;    DOT         Street Condition
## 2 2015-04-12 02:08:53 2015-04-12 02:09:52    HRA Benefit Card Replacement
## 3 2015-04-12 02:08:40                &lt;NA&gt;   NYPD       Noise - Commercial
##         Descriptor     City
## 1          Pothole         
## 2         Medicaid         
## 3 Loud Music/Party NEW YORK</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(123, 217, 123)); /* Standard syntax; must be last */">user: 0.005 | system: 0.000 | elapsed: 0.006</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print.data.frame</span>(<span class="kw">head</span>(service, <span class="dv">3</span>))</code></pre></div>
<pre><code>##           CreatedDate          ClosedDate Agency            ComplaintType
## 1 2015-04-12 02:41:17                &lt;NA&gt;    DOT         Street Condition
## 2 2015-04-12 02:08:53 2015-04-12 02:09:52    HRA Benefit Card Replacement
## 3 2015-04-12 02:08:40                &lt;NA&gt;   NYPD       Noise - Commercial
##         Descriptor     City
## 1          Pothole         
## 2         Medicaid         
## 3 Loud Music/Party NEW YORK</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(131, 205, 116)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(131, 205, 116)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(131, 205, 116)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(131, 205, 116)); /* Standard syntax; must be last */">user: 0.045 | system: 0.057 | elapsed: 0.115</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## A different way to check the structure of object
<span class="kw">str</span>(service)</code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    9115505 obs. of  6 variables:
##  $ CreatedDate  : chr  &quot;2015-04-12 02:41:17&quot; &quot;2015-04-12 02:08:53&quot; &quot;2015-04-12 02:08:40&quot; &quot;2015-04-12 02:08:24&quot; ...
##  $ ClosedDate   : chr  NA &quot;2015-04-12 02:09:52&quot; NA NA ...
##  $ Agency       : Factor w/ 64 levels &quot;3-1-1&quot;,&quot;ACS&quot;,..: 25 35 50 50 50 50 50 50 16 50 ...
##  $ ComplaintType: Factor w/ 245 levels &quot;Adopt-A-Basket&quot;,..: 203 10 135 139 135 139 135 139 103 135 ...
##  $ Descriptor   : chr  &quot;Pothole&quot; &quot;Medicaid&quot; &quot;Loud Music/Party&quot; &quot;Loud Talking&quot; ...
##  $ City         : Factor w/ 1817 levels &quot;&quot;,&quot;*&quot;,&quot;/&quot;,&quot;/A&quot;,..: 1 1 1080 877 1080 1080 65 181 1 1080 ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(124, 217, 122)); /* Standard syntax; must be last */">user: 0.01 | system: 0.00 | elapsed: 0.01</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(service, <span class="dv">3</span>)</code></pre></div>
<pre><code>## Source: local data frame [3 x 6]
## 
##           CreatedDate          ClosedDate Agency            ComplaintType
## 1 2015-04-12 02:41:17                  NA    DOT         Street Condition
## 2 2015-04-12 02:08:53 2015-04-12 02:09:52    HRA Benefit Card Replacement
## 3 2015-04-12 02:08:40                  NA   NYPD       Noise - Commercial
## Variables not shown: Descriptor (chr), City (fctr)</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(124, 217, 122)); /* Standard syntax; must be last */">user: 0.01 | system: 0.00 | elapsed: 0.01</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(service_db, <span class="dv">3</span>)</code></pre></div>
<pre><code>##           CreatedDate          ClosedDate Agency            ComplaintType
## 1 2015-04-12 02:41:17                &lt;NA&gt;    DOT         Street Condition
## 2 2015-04-12 02:08:53 2015-04-12 02:09:52    HRA Benefit Card Replacement
## 3 2015-04-12 02:08:40                &lt;NA&gt;   NYPD       Noise - Commercial
##         Descriptor     City
## 1          Pothole         
## 2         Medicaid         
## 3 Loud Music/Party NEW YORK</code></pre>
</div>
We don’t have to call <code>head</code>, as I mentioned above.
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(124, 217, 122)); /* Standard syntax; must be last */">user: 0.009 | system: 0.000 | elapsed: 0.009</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service</code></pre></div>
<pre><code>## Source: local data frame [9,115,505 x 6]
## 
##            CreatedDate          ClosedDate Agency
## 1  2015-04-12 02:41:17                  NA    DOT
## 2  2015-04-12 02:08:53 2015-04-12 02:09:52    HRA
## 3  2015-04-12 02:08:40                  NA   NYPD
## 4  2015-04-12 02:08:24                  NA   NYPD
## 5  2015-04-12 02:04:39                  NA   NYPD
## 6  2015-04-12 02:01:31 2015-04-12 02:47:01   NYPD
## 7  2015-04-12 02:00:35 2015-04-12 02:55:34   NYPD
## 8  2015-04-12 01:59:14                  NA   NYPD
## 9  2015-04-12 01:58:18 2015-04-12 01:58:41    DHS
## 10 2015-04-12 01:57:05                  NA   NYPD
## ..                 ...                 ...    ...
## Variables not shown: ComplaintType (fctr), Descriptor (chr), City (fctr)</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user:  0.605 | system:  2.153 | elapsed: 10.347</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_db</code></pre></div>
<pre><code>## Source: sqlite 3.8.6 [noshare/service.sqlite]
## From: data [9,115,505 x 6]
## 
##            CreatedDate          ClosedDate Agency
## 1  2015-04-12 02:41:17                  NA    DOT
## 2  2015-04-12 02:08:53 2015-04-12 02:09:52    HRA
## 3  2015-04-12 02:08:40                  NA   NYPD
## 4  2015-04-12 02:08:24                  NA   NYPD
## 5  2015-04-12 02:04:39                  NA   NYPD
## 6  2015-04-12 02:01:31 2015-04-12 02:47:01   NYPD
## 7  2015-04-12 02:00:35 2015-04-12 02:55:34   NYPD
## 8  2015-04-12 01:59:14                  NA   NYPD
## 9  2015-04-12 01:58:18 2015-04-12 01:58:41    DHS
## 10 2015-04-12 01:57:05                  NA   NYPD
## ..                 ...                 ...    ...
## Variables not shown: ComplaintType (chr), Descriptor (chr), City (chr)</code></pre>
</div>
<h1 id="select-just-a-couple-of-columns">Select just a couple of columns</h1>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(123, 217, 123)); /* Standard syntax; must be last */">user: 0.006 | system: 0.000 | elapsed: 0.006</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service[<span class="dv">1</span>:<span class="dv">3</span>, <span class="kw">c</span>(<span class="st">&quot;Agency&quot;</span>, <span class="st">&quot;Descriptor&quot;</span>)]</code></pre></div>
<pre><code>## Source: local data frame [3 x 2]
## 
##   Agency       Descriptor
## 1    DOT          Pothole
## 2    HRA         Medicaid
## 3   NYPD Loud Music/Party</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(124, 216, 122)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(124, 216, 122)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(124, 216, 122)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(124, 216, 122)); /* Standard syntax; must be last */">user: 0.014 | system: 0.002 | elapsed: 0.019</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service %&gt;%
<span class="st">  </span><span class="kw">select</span>(Agency, Descriptor) %&gt;%
<span class="st">  </span><span class="kw">head</span>(<span class="dv">3</span>)</code></pre></div>
<pre><code>## Source: local data frame [3 x 2]
## 
##   Agency       Descriptor
## 1    DOT          Pothole
## 2    HRA         Medicaid
## 3   NYPD Loud Music/Party</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(124, 217, 122)); /* Standard syntax; must be last */">user: 0.012 | system: 0.001 | elapsed: 0.012</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_db %&gt;%
<span class="st">  </span><span class="kw">select</span>(Agency, Descriptor) %&gt;%
<span class="st">  </span><span class="kw">head</span>(<span class="dv">3</span>)</code></pre></div>
<pre><code>##   Agency       Descriptor
## 1    DOT          Pothole
## 2    HRA         Medicaid
## 3   NYPD Loud Music/Party</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(123, 217, 123)); /* Standard syntax; must be last */">user: 0.005 | system: 0.000 | elapsed: 0.005</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dbGetQuery</span>(db, <span class="st">&#39;SELECT Agency, Descriptor FROM data LIMIT 3&#39;</span>)</code></pre></div>
<pre><code>##   Agency       Descriptor
## 1    DOT          Pothole
## 2    HRA         Medicaid
## 3   NYPD Loud Music/Party</code></pre>
</div>
<h1 id="filter-rows-by-value">Filter rows by value</h1>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(177, 128, 72)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(177, 128, 72)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(177, 128, 72)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(177, 128, 72)); /* Standard syntax; must be last */">user: 0.730 | system: 0.092 | elapsed: 0.824</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service %&gt;%
<span class="st">  </span><span class="kw">select</span>(ComplaintType, Descriptor, Agency) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(Agency ==<span class="st"> &quot;NYPD&quot;</span>)</code></pre></div>
<pre><code>## Source: local data frame [1,021,412 x 3]
## 
##              ComplaintType       Descriptor Agency
## 1       Noise - Commercial Loud Music/Party   NYPD
## 2  Noise - Street/Sidewalk     Loud Talking   NYPD
## 3       Noise - Commercial Loud Music/Party   NYPD
## 4  Noise - Street/Sidewalk     Loud Talking   NYPD
## 5       Noise - Commercial Loud Music/Party   NYPD
## 6  Noise - Street/Sidewalk Loud Music/Party   NYPD
## 7       Noise - Commercial  Car/Truck Music   NYPD
## 8       Noise - Commercial Loud Music/Party   NYPD
## 9         Blocked Driveway   Partial Access   NYPD
## 10      Noise - Commercial Loud Music/Party   NYPD
## ..                     ...              ...    ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 1.669 | system: 0.874 | elapsed: 2.550</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_db %&gt;%
<span class="st">  </span><span class="kw">select</span>(ComplaintType, Descriptor, Agency) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(Agency ==<span class="st"> &quot;NYPD&quot;</span>)</code></pre></div>
<pre><code>## Source: sqlite 3.8.6 [noshare/service.sqlite]
## From: data [1,021,412 x 3]
## Filter: Agency == &quot;NYPD&quot; 
## 
##              ComplaintType       Descriptor Agency
## 1       Noise - Commercial Loud Music/Party   NYPD
## 2  Noise - Street/Sidewalk     Loud Talking   NYPD
## 3       Noise - Commercial Loud Music/Party   NYPD
## 4  Noise - Street/Sidewalk     Loud Talking   NYPD
## 5       Noise - Commercial Loud Music/Party   NYPD
## 6  Noise - Street/Sidewalk Loud Music/Party   NYPD
## 7       Noise - Commercial  Car/Truck Music   NYPD
## 8       Noise - Commercial Loud Music/Party   NYPD
## 9         Blocked Driveway   Partial Access   NYPD
## 10      Noise - Commercial Loud Music/Party   NYPD
## ..                     ...              ...    ...</code></pre>
</div>
<p>We don’t have to call <code>head</code>, but it runs faster here if we call <code>head</code>.</p>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 1.672 | system: 0.874 | elapsed: 2.552</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_db %&gt;%
<span class="st">  </span><span class="kw">select</span>(ComplaintType, Descriptor, Agency) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(Agency ==<span class="st"> &quot;NYPD&quot;</span>)</code></pre></div>
<pre><code>## Source: sqlite 3.8.6 [noshare/service.sqlite]
## From: data [1,021,412 x 3]
## Filter: Agency == &quot;NYPD&quot; 
## 
##              ComplaintType       Descriptor Agency
## 1       Noise - Commercial Loud Music/Party   NYPD
## 2  Noise - Street/Sidewalk     Loud Talking   NYPD
## 3       Noise - Commercial Loud Music/Party   NYPD
## 4  Noise - Street/Sidewalk     Loud Talking   NYPD
## 5       Noise - Commercial Loud Music/Party   NYPD
## 6  Noise - Street/Sidewalk Loud Music/Party   NYPD
## 7       Noise - Commercial  Car/Truck Music   NYPD
## 8       Noise - Commercial Loud Music/Party   NYPD
## 9         Blocked Driveway   Partial Access   NYPD
## 10      Noise - Commercial Loud Music/Party   NYPD
## ..                     ...              ...    ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(123, 217, 123)); /* Standard syntax; must be last */">user: 0.007 | system: 0.001 | elapsed: 0.007</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dbGetQuery</span>(db,
           <span class="st">&#39;SELECT ComplaintType, Descriptor, Agency</span>
<span class="st">           FROM data</span>
<span class="st">           WHERE Agency = &quot;NYPD&quot;</span>
<span class="st">           LIMIT 10&#39;</span>)           </code></pre></div>
<pre><code>##              ComplaintType       Descriptor Agency
## 1       Noise - Commercial Loud Music/Party   NYPD
## 2  Noise - Street/Sidewalk     Loud Talking   NYPD
## 3       Noise - Commercial Loud Music/Party   NYPD
## 4  Noise - Street/Sidewalk     Loud Talking   NYPD
## 5       Noise - Commercial Loud Music/Party   NYPD
## 6  Noise - Street/Sidewalk Loud Music/Party   NYPD
## 7       Noise - Commercial  Car/Truck Music   NYPD
## 8       Noise - Commercial Loud Music/Party   NYPD
## 9         Blocked Driveway   Partial Access   NYPD
## 10      Noise - Commercial Loud Music/Party   NYPD</code></pre>
</div>
<h1 id="filter-rows-by-set-of-values">Filter rows by set of values</h1>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(173, 135, 76)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(173, 135, 76)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(173, 135, 76)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(173, 135, 76)); /* Standard syntax; must be last */">user: 0.633 | system: 0.122 | elapsed: 0.761</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">subset</span>(service, Agency %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;NYPD&quot;</span>, <span class="st">&quot;DOB&quot;</span>),
       <span class="dt">select =</span> <span class="kw">c</span>(<span class="st">&quot;ComplaintType&quot;</span>, <span class="st">&quot;Descriptor&quot;</span>, <span class="st">&quot;Agency&quot;</span>))</code></pre></div>
<pre><code>## Source: local data frame [1,496,758 x 3]
## 
##              ComplaintType       Descriptor Agency
## 1       Noise - Commercial Loud Music/Party   NYPD
## 2  Noise - Street/Sidewalk     Loud Talking   NYPD
## 3       Noise - Commercial Loud Music/Party   NYPD
## 4  Noise - Street/Sidewalk     Loud Talking   NYPD
## 5       Noise - Commercial Loud Music/Party   NYPD
## 6  Noise - Street/Sidewalk Loud Music/Party   NYPD
## 7       Noise - Commercial  Car/Truck Music   NYPD
## 8       Noise - Commercial Loud Music/Party   NYPD
## 9         Blocked Driveway   Partial Access   NYPD
## 10      Noise - Commercial Loud Music/Party   NYPD
## ..                     ...              ...    ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(150, 174, 98)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(150, 174, 98)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(150, 174, 98)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(150, 174, 98)); /* Standard syntax; must be last */">user: 0.351 | system: 0.054 | elapsed: 0.404</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service %&gt;%
<span class="st">  </span><span class="kw">select</span>(ComplaintType, Descriptor, Agency) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(Agency %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;NYPD&quot;</span>, <span class="st">&quot;DOB&quot;</span>))</code></pre></div>
<pre><code>## Source: local data frame [1,496,758 x 3]
## 
##              ComplaintType       Descriptor Agency
## 1       Noise - Commercial Loud Music/Party   NYPD
## 2  Noise - Street/Sidewalk     Loud Talking   NYPD
## 3       Noise - Commercial Loud Music/Party   NYPD
## 4  Noise - Street/Sidewalk     Loud Talking   NYPD
## 5       Noise - Commercial Loud Music/Party   NYPD
## 6  Noise - Street/Sidewalk Loud Music/Party   NYPD
## 7       Noise - Commercial  Car/Truck Music   NYPD
## 8       Noise - Commercial Loud Music/Party   NYPD
## 9         Blocked Driveway   Partial Access   NYPD
## 10      Noise - Commercial Loud Music/Party   NYPD
## ..                     ...              ...    ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(148, 177, 100)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(148, 177, 100)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(148, 177, 100)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(148, 177, 100)); /* Standard syntax; must be last */">user: 0.341 | system: 0.037 | elapsed: 0.378</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service %&gt;%
<span class="st">  </span><span class="kw">select</span>(ComplaintType, Descriptor, Agency) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(Agency %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;NYPD&quot;</span>, <span class="st">&quot;DOB&quot;</span>)) %&gt;%
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span>:<span class="dv">10</span>)</code></pre></div>
<pre><code>## Source: local data frame [10 x 3]
## 
##              ComplaintType       Descriptor Agency
## 1       Noise - Commercial Loud Music/Party   NYPD
## 2  Noise - Street/Sidewalk     Loud Talking   NYPD
## 3       Noise - Commercial Loud Music/Party   NYPD
## 4  Noise - Street/Sidewalk     Loud Talking   NYPD
## 5       Noise - Commercial Loud Music/Party   NYPD
## 6  Noise - Street/Sidewalk Loud Music/Party   NYPD
## 7       Noise - Commercial  Car/Truck Music   NYPD
## 8       Noise - Commercial Loud Music/Party   NYPD
## 9         Blocked Driveway   Partial Access   NYPD
## 10      Noise - Commercial Loud Music/Party   NYPD</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 2.152 | system: 0.886 | elapsed: 3.045</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_db %&gt;%
<span class="st">  </span><span class="kw">select</span>(ComplaintType, Descriptor, Agency) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(Agency %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;NYPD&quot;</span>, <span class="st">&quot;DOB&quot;</span>))</code></pre></div>
<pre><code>## Source: sqlite 3.8.6 [noshare/service.sqlite]
## From: data [1,496,758 x 3]
## Filter: Agency %in% c(&quot;NYPD&quot;, &quot;DOB&quot;) 
## 
##              ComplaintType       Descriptor Agency
## 1       Noise - Commercial Loud Music/Party   NYPD
## 2  Noise - Street/Sidewalk     Loud Talking   NYPD
## 3       Noise - Commercial Loud Music/Party   NYPD
## 4  Noise - Street/Sidewalk     Loud Talking   NYPD
## 5       Noise - Commercial Loud Music/Party   NYPD
## 6  Noise - Street/Sidewalk Loud Music/Party   NYPD
## 7       Noise - Commercial  Car/Truck Music   NYPD
## 8       Noise - Commercial Loud Music/Party   NYPD
## 9         Blocked Driveway   Partial Access   NYPD
## 10      Noise - Commercial Loud Music/Party   NYPD
## ..                     ...              ...    ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(124, 216, 122)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(124, 216, 122)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(124, 216, 122)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(124, 216, 122)); /* Standard syntax; must be last */">user: 0.017 | system: 0.000 | elapsed: 0.017</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_db %&gt;%
<span class="st">  </span><span class="kw">select</span>(ComplaintType, Descriptor, Agency) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(Agency %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;NYPD&quot;</span>, <span class="st">&quot;DOB&quot;</span>)) %&gt;%<span class="st"> </span><span class="kw">head</span>(<span class="dv">10</span>)</code></pre></div>
<pre><code>##              ComplaintType       Descriptor Agency
## 1       Noise - Commercial Loud Music/Party   NYPD
## 2  Noise - Street/Sidewalk     Loud Talking   NYPD
## 3       Noise - Commercial Loud Music/Party   NYPD
## 4  Noise - Street/Sidewalk     Loud Talking   NYPD
## 5       Noise - Commercial Loud Music/Party   NYPD
## 6  Noise - Street/Sidewalk Loud Music/Party   NYPD
## 7       Noise - Commercial  Car/Truck Music   NYPD
## 8       Noise - Commercial Loud Music/Party   NYPD
## 9         Blocked Driveway   Partial Access   NYPD
## 10      Noise - Commercial Loud Music/Party   NYPD</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(123, 217, 123)); /* Standard syntax; must be last */">user: 0.007 | system: 0.000 | elapsed: 0.007</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dbGetQuery</span>(db, 
           <span class="st">&#39;SELECT ComplaintType, Descriptor, Agency </span>
<span class="st">            FROM data </span>
<span class="st">            WHERE Agency IN (&quot;NYPD&quot;, &quot;DOB&quot;)</span>
<span class="st">            LIMIT 10&#39;</span>)</code></pre></div>
<pre><code>##              ComplaintType       Descriptor Agency
## 1       Noise - Commercial Loud Music/Party   NYPD
## 2  Noise - Street/Sidewalk     Loud Talking   NYPD
## 3       Noise - Commercial Loud Music/Party   NYPD
## 4  Noise - Street/Sidewalk     Loud Talking   NYPD
## 5       Noise - Commercial Loud Music/Party   NYPD
## 6  Noise - Street/Sidewalk Loud Music/Party   NYPD
## 7       Noise - Commercial  Car/Truck Music   NYPD
## 8       Noise - Commercial Loud Music/Party   NYPD
## 9         Blocked Driveway   Partial Access   NYPD
## 10      Noise - Commercial Loud Music/Party   NYPD</code></pre>
</div>
<h1 id="find-the-unique-values">Find the unique values</h1>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(132, 204, 115)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(132, 204, 115)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(132, 204, 115)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(132, 204, 115)); /* Standard syntax; must be last */">user: 0.116 | system: 0.012 | elapsed: 0.130</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">unique</span>(service$City))</code></pre></div>
<pre><code>## [1]                  NEW YORK         LONG ISLAND CITY ASTORIA         
## [5] BROOKLYN         FLUSHING        
## 1817 Levels:  * / /A 0 00 000 0000 0000 0000 000000 00000000000 ... YORKTOWN HEIGHTS</code></pre>
</div>
<p>Many of the values such “*“,”00&quot; seems represent missing values, but it takes too long to clean them. Let me pretend that I have never seen them.</p>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(125, 215, 121)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(125, 215, 121)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(125, 215, 121)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(125, 215, 121)); /* Standard syntax; must be last */">user: 0.025 | system: 0.000 | elapsed: 0.026</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_db %&gt;%
<span class="st">  </span><span class="kw">summarize</span>(<span class="kw">distinct</span>(City)) %&gt;%
<span class="st">  </span>explain_and_eval</code></pre></div>
<pre><code>## &lt;SQL&gt;
## SELECT &quot;distinct(City)&quot;
## FROM (SELECT DISTINCT(&quot;City&quot;) AS &quot;distinct(City)&quot;
## FROM &quot;data&quot;) AS &quot;_W1&quot;
## 
## 
## &lt;PLAN&gt;
##   selectid order from                       detail
## 1        1     0    0              SCAN TABLE data
## 2        1     0    0 USE TEMP B-TREE FOR DISTINCT
## 3        0     0    0       SCAN SUBQUERY 1 AS _W1</code></pre>
<pre><code>## NULL</code></pre>
<pre><code>## Source: sqlite 3.8.6 [noshare/service.sqlite]
## From: &lt;derived table&gt; [?? x 1]
## 
##      distinct(City)
## 1                  
## 2          NEW YORK
## 3  LONG ISLAND CITY
## 4           ASTORIA
## 5          BROOKLYN
## 6          FLUSHING
## 7       KEW GARDENS
## 8         RIDGEWOOD
## 9             BRONX
## 10    STATEN ISLAND
## ..              ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 4.829 | system: 0.939 | elapsed: 5.779</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">distinct_city &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(db, <span class="st">&#39;SELECT DISTINCT City FROM data&#39;</span>)
<span class="kw">head</span>(distinct_city)</code></pre></div>
<pre><code>##               City
## 1                 
## 2         NEW YORK
## 3 LONG ISLAND CITY
## 4          ASTORIA
## 5         BROOKLYN
## 6         FLUSHING</code></pre>
</div>
<h1 id="query-value-counts">Query value counts</h1>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(146, 179, 101)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(146, 179, 101)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(146, 179, 101)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(146, 179, 101)); /* Standard syntax; must be last */">user: 0.291 | system: 0.062 | elapsed: 0.355</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service %&gt;%
<span class="st">  </span><span class="kw">count</span>(Agency) %&gt;%
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">num_complaints =</span> n)</code></pre></div>
<pre><code>## Source: local data frame [64 x 2]
## 
##    Agency num_complaints
## 1   3-1-1          22501
## 2     ACS              3
## 3     AJC              7
## 4     ART              3
## 5     CAU              8
## 6    CCRB              9
## 7   CHALL          10807
## 8    COIB             21
## 9     CWI              4
## 10    DCA         125433
## ..    ...            ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 12.14 | system:  1.91 | elapsed: 14.15</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_db %&gt;%
<span class="st">  </span><span class="kw">count</span>(Agency) %&gt;%
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">num_complaints =</span> n) %&gt;%
<span class="st">  </span>explain_and_eval</code></pre></div>
<pre><code>## &lt;SQL&gt;
## SELECT &quot;Agency&quot; AS &quot;Agency&quot;, &quot;n&quot; AS &quot;num_complaints&quot;
## FROM (SELECT &quot;Agency&quot;, COUNT() AS &quot;n&quot;
## FROM &quot;data&quot;
## GROUP BY &quot;Agency&quot;) AS &quot;_W2&quot;
## 
## 
## &lt;PLAN&gt;
##   selectid order from                       detail
## 1        0     0    0              SCAN TABLE data
## 2        0     0    0 USE TEMP B-TREE FOR GROUP BY</code></pre>
<pre><code>## NULL</code></pre>
<pre><code>## Source: sqlite 3.8.6 [noshare/service.sqlite]
## From: &lt;derived table&gt; [?? x 2]
## 
##    Agency num_complaints
## 1   3-1-1          22501
## 2     ACS              3
## 3     AJC              7
## 4     ART              3
## 5     CAU              8
## 6    CCRB              9
## 7   CHALL          10807
## 8    COIB             21
## 9     CWI              4
## 10    DCA         125433
## ..    ...            ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 14.66 | system:  1.95 | elapsed: 16.67</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dbGetQuery</span>(db, <span class="st">&#39;SELECT Agency, COUNT(*) as `num_complaints`</span>
<span class="st">                FROM data </span>
<span class="st">                GROUP BY Agency&#39;</span>) %&gt;%<span class="st"> </span>head</code></pre></div>
<pre><code>##   Agency num_complaints
## 1  3-1-1          22501
## 2    ACS              3
## 3    AJC              7
## 4    ART              3
## 5    CAU              8
## 6   CCRB              9</code></pre>
</div>
<h1 id="order-the-result">Order the result</h1>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(144, 183, 103)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(144, 183, 103)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(144, 183, 103)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(144, 183, 103)); /* Standard syntax; must be last */">user: 0.272 | system: 0.048 | elapsed: 0.321</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(complaints_by_agency &lt;-
<span class="st">    </span>service %&gt;%
<span class="st">      </span><span class="kw">count</span>(Agency, <span class="dt">sort =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## Source: local data frame [64 x 2]
## 
##    Agency       n
## 1     HPD 3316474
## 2     DOT 1599851
## 3    NYPD 1021412
## 4     DEP  837824
## 5    DSNY  685332
## 6     DOB  475346
## 7     DPR  405656
## 8   DOHMH  263252
## 9     DOF  129467
## 10    DCA  125433
## ..    ...     ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 14.76 | system:  2.02 | elapsed: 16.88</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_db %&gt;%
<span class="st">  </span><span class="kw">count</span>(Agency, <span class="dt">sort =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Source: sqlite 3.8.6 [noshare/service.sqlite]
## From: &lt;derived table&gt; [?? x 2]
## Arrange: desc(n) 
## 
##    Agency       n
## 1     HPD 3316474
## 2     DOT 1599851
## 3    NYPD 1021412
## 4     DEP  837824
## 5    DSNY  685332
## 6     DOB  475346
## 7     DPR  405656
## 8   DOHMH  263252
## 9     DOF  129467
## 10    DCA  125433
## ..    ...     ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 14.76 | system:  1.97 | elapsed: 16.83</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dbGetQuery</span>(db, <span class="st">&#39;SELECT Agency, COUNT(*) as `num_complaints`</span>
<span class="st">                FROM data </span>
<span class="st">                GROUP BY Agency</span>
<span class="st">                ORDER BY -num_complaints&#39;</span>) %&gt;%<span class="st"> </span>head</code></pre></div>
<pre><code>##   Agency num_complaints
## 1    HPD        3316474
## 2    DOT        1599851
## 3   NYPD        1021412
## 4    DEP         837824
## 5   DSNY         685332
## 6    DOB         475346</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(123, 217, 123)); /* Standard syntax; must be last */">user: 0.005 | system: 0.000 | elapsed: 0.005</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## A help function, to adjust the plot order.
## Created a ordered factor, with levels the same as input order.
ordered_asis &lt;-<span class="st"> </span>function(x) {
    <span class="kw">ordered</span>(x, <span class="dt">levels =</span> x)
}</code></pre></div>
</div>
<p>I prefer dot plots instead of bar plots here, since it is easier to read when the columns are dense.</p>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(163, 152, 86)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(163, 152, 86)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(163, 152, 86)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(163, 152, 86)); /* Standard syntax; must be last */">user: 0.523 | system: 0.053 | elapsed: 0.606</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(complaints_by_agency, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">ordered_asis</span>(Agency), <span class="dt">y =</span> n)) +
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Agency&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Number of Complaints&quot;</span>) +
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;#01AFE1&quot;</span> ) +<span class="st"> </span><span class="kw">scale_y_log10</span>(<span class="dt">labels =</span> <span class="kw">comma_format</span>()) +
<span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> -<span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>))</code></pre></div>
<div class="figure">
<img src="/articles/00050-311-service/figure/plot_complaints_by_agency-1.png" alt="plot of chunk plot_complaints_by_agency" />
<p class="caption">plot of chunk plot_complaints_by_agency</p>
</div>
</div>
<h1 id="most-common-complaint">Most common complaint</h1>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(148, 177, 100)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(148, 177, 100)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(148, 177, 100)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(148, 177, 100)); /* Standard syntax; must be last */">user: 0.331 | system: 0.041 | elapsed: 0.373</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(complaints_by_type &lt;-<span class="st"> </span>service %&gt;%
<span class="st">   </span><span class="kw">count</span>(ComplaintType, <span class="dt">sort =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## Source: local data frame [245 x 2]
## 
##             ComplaintType      n
## 1                 HEATING 887675
## 2        Street Condition 525822
## 3  Street Light Condition 524150
## 4    GENERAL CONSTRUCTION 501514
## 5                PLUMBING 478633
## 6         PAINT - PLASTER 361449
## 7        Blocked Driveway 316700
## 8            Water System 316362
## 9                NONCONST 260405
## 10         HEAT/HOT WATER 260272
## ..                    ...    ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 16.86 | system:  2.79 | elapsed: 19.74</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_db %&gt;%
<span class="st">  </span><span class="kw">count</span>(ComplaintType, <span class="dt">sort =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Source: sqlite 3.8.6 [noshare/service.sqlite]
## From: &lt;derived table&gt; [?? x 2]
## Arrange: desc(n) 
## 
##             ComplaintType      n
## 1                 HEATING 887675
## 2        Street Condition 525822
## 3  Street Light Condition 524150
## 4    GENERAL CONSTRUCTION 501514
## 5                PLUMBING 478633
## 6         PAINT - PLASTER 361449
## 7        Blocked Driveway 316700
## 8            Water System 316362
## 9                NONCONST 260405
## 10         HEAT/HOT WATER 260272
## ..                    ...    ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(144, 183, 103)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(144, 183, 103)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(144, 183, 103)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(144, 183, 103)); /* Standard syntax; must be last */">user: 0.289 | system: 0.032 | elapsed: 0.321</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Another method to count
service %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(ComplaintType) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n))</code></pre></div>
<pre><code>## Source: local data frame [245 x 2]
## 
##             ComplaintType      n
## 1                 HEATING 887675
## 2        Street Condition 525822
## 3  Street Light Condition 524150
## 4    GENERAL CONSTRUCTION 501514
## 5                PLUMBING 478633
## 6         PAINT - PLASTER 361449
## 7        Blocked Driveway 316700
## 8            Water System 316362
## 9                NONCONST 260405
## 10         HEAT/HOT WATER 260272
## ..                    ...    ...</code></pre>
</div>
<p>Plot the top 40 complaints types. It’s hard to display more than two hundred columns in a plot.</p>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(160, 158, 89)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(160, 158, 89)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(160, 158, 89)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(160, 158, 89)); /* Standard syntax; must be last */">user: 0.477 | system: 0.045 | elapsed: 0.555</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="kw">head</span>(complaints_by_type, <span class="dv">40</span>),
       <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">ordered_asis</span>(ComplaintType), <span class="dt">y =</span> n)) +
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;#01AFE1&quot;</span>) +
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Number of Complaints&quot;</span>) +
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> <span class="kw">comma_format</span>()) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> -<span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>))</code></pre></div>
<div class="figure">
<img src="/articles/00050-311-service/figure/plot_complaints_by_type-1.png" alt="plot of chunk plot_complaints_by_type" />
<p class="caption">plot of chunk plot_complaints_by_type</p>
</div>
</div>
<h1 id="the-most-common-complaint-in-each-city">The most common complaint in each city</h1>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 3.845 | system: 0.136 | elapsed: 4.034</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(complaints_by_city &lt;-<span class="st"> </span>service %&gt;%
<span class="st">   </span><span class="kw">count</span>(<span class="dt">City =</span> <span class="kw">toupper</span>(City), <span class="dt">sort =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">   </span><span class="kw">filter</span>(City !=<span class="st"> &quot;&quot;</span>))</code></pre></div>
<pre><code>## Source: local data frame [1,771 x 2]
## 
##             City       n
## 1       BROOKLYN 2671999
## 2       NEW YORK 1693305
## 3          BRONX 1624816
## 4  STATEN ISLAND  437496
## 5        JAMAICA  214303
## 6       FLUSHING  162754
## 7        ASTORIA  128548
## 8      RIDGEWOOD   94027
## 9       WOODSIDE   66632
## 10        CORONA   65658
## ..           ...     ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(124, 217, 122)); /* Standard syntax; must be last */">user: 0.009 | system: 0.001 | elapsed: 0.010</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">type_ordered &lt;-<span class="st"> </span><span class="kw">ordered_asis</span>(complaints_by_type$ComplaintType)
city_ordered &lt;-<span class="st"> </span><span class="kw">ordered_asis</span>(complaints_by_city$City)
type_top &lt;-<span class="st"> </span>type_ordered[<span class="dv">1</span>:<span class="dv">20</span>]
city_top &lt;-<span class="st"> </span>city_ordered[<span class="dv">1</span>:<span class="dv">20</span>]</code></pre></div>
</div>
<div class="code_chunk">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(complaints_city_type &lt;-<span class="st"> </span>service %&gt;%
<span class="st">   </span><span class="kw">filter</span>(City %in%<span class="st"> </span>city_top, ComplaintType %in%<span class="st"> </span>type_top) %&gt;%
<span class="st">   </span><span class="kw">mutate</span>(<span class="dt">City =</span> <span class="kw">factor</span>(City, city_top), <span class="dt">ComplaintType =</span> <span class="kw">factor</span>(ComplaintType, type_top)) %&gt;%
<span class="st">   </span><span class="kw">count</span>(City, ComplaintType))</code></pre></div>
<pre><code>## Source: local data frame [384 x 3]
## Groups: City
## 
##        City          ComplaintType      n
## 1  BROOKLYN                HEATING 280299
## 2  BROOKLYN       Street Condition 123619
## 3  BROOKLYN Street Light Condition  89731
## 4  BROOKLYN   GENERAL CONSTRUCTION 187974
## 5  BROOKLYN               PLUMBING 176458
## 6  BROOKLYN        PAINT - PLASTER 133844
## 7  BROOKLYN       Blocked Driveway 117669
## 8  BROOKLYN           Water System  77952
## 9  BROOKLYN               NONCONST 100967
## 10 BROOKLYN         HEAT/HOT WATER  78084
## ..      ...                    ...    ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(186, 113, 64)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(186, 113, 64)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(186, 113, 64)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(186, 113, 64)); /* Standard syntax; must be last */">user: 0.833 | system: 0.094 | elapsed: 0.960</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(complaints_city_type,
       <span class="kw">aes</span>(<span class="dt">x =</span> ComplaintType, <span class="dt">y =</span> n, <span class="dt">fill =</span> City, <span class="dt">order =</span>-<span class="kw">as.numeric</span>(City))) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) +
<span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) +<span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> <span class="kw">comma_format</span>()) +
<span class="st">  </span><span class="kw">scale_fill_discrete</span>(<span class="dt">h =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">360</span> *<span class="st"> </span><span class="dv">7</span>)) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> -<span class="dv">45</span>, <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">vjust =</span> <span class="dv">1</span>),
        <span class="dt">legend.key.size =</span> <span class="kw">unit</span>(<span class="dv">14</span>, <span class="st">&quot;points&quot;</span>))</code></pre></div>
<div class="figure">
<img src="/articles/00050-311-service/figure/plot_complaints_city_type-1.png" alt="plot of chunk plot_complaints_city_type" />
<p class="caption">plot of chunk plot_complaints_city_type</p>
</div>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(182, 121, 68)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(182, 121, 68)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(182, 121, 68)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(182, 121, 68)); /* Standard syntax; must be last */">user: 0.803 | system: 0.056 | elapsed: 0.888</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(complaints_city_type,
       <span class="kw">aes</span>(<span class="dt">x =</span> City, <span class="dt">y =</span> n, <span class="dt">fill =</span> ComplaintType, <span class="dt">order =</span> -<span class="kw">as.numeric</span>(ComplaintType))) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) +<span class="st"> </span><span class="kw">scale_fill_discrete</span>(<span class="dt">h =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">360</span> *<span class="st"> </span><span class="dv">7</span>)) +
<span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> -<span class="dv">45</span>, <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">vjust =</span> <span class="dv">1</span>),
        <span class="dt">legend.key.size =</span> <span class="kw">unit</span>(<span class="dv">14</span>, <span class="st">&quot;points&quot;</span>))</code></pre></div>
<div class="figure">
<img src="/articles/00050-311-service/figure/plot_complaints_type_city-1.png" alt="plot of chunk plot_complaints_type_city" />
<p class="caption">plot of chunk plot_complaints_type_city</p>
</div>
</div>
And if we are more interested in proportion of complaint type for each city.
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(187, 112, 63)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(187, 112, 63)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(187, 112, 63)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(187, 112, 63)); /* Standard syntax; must be last */">user: 0.862 | system: 0.070 | elapsed: 0.974</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="kw">arrange</span>(complaints_city_type, City, ComplaintType),
       <span class="kw">aes</span>(<span class="dt">x =</span> City, <span class="dt">y =</span> n, <span class="dt">fill =</span> ComplaintType, <span class="dt">order =</span> -<span class="kw">as.numeric</span>(ComplaintType))) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>) +<span class="st"> </span><span class="kw">scale_fill_discrete</span>(<span class="dt">h =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">360</span> *<span class="st"> </span><span class="dv">7</span>)) +
<span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> -<span class="dv">45</span>, <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">vjust =</span> <span class="dv">1</span>),
        <span class="dt">legend.key.size =</span> <span class="kw">unit</span>(<span class="dv">14</span>, <span class="st">&quot;points&quot;</span>),
        <span class="dt">panel.grid.major.y =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.grid.minor.y =</span> <span class="kw">element_blank</span>())</code></pre></div>
<div class="figure">
<img src="/articles/00050-311-service/figure/plot_complaints_type_city_fill-1.png" alt="plot of chunk plot_complaints_type_city_fill" />
<p class="caption">plot of chunk plot_complaints_type_city_fill</p>
</div>
</div>
<h1 id="filter-rows-with-time-stamp-strings">Filter rows with time stamp strings</h1>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 5.801 | system: 0.083 | elapsed: 5.922</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service %&gt;%
<span class="st">  </span><span class="kw">filter</span>(CreatedDate &lt;<span class="st"> &quot;2014-11-16 23:47:00&quot;</span>,
         CreatedDate &gt;<span class="st"> &quot;2014-11-16 23:45:00&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(ComplaintType, CreatedDate, City)</code></pre></div>
<pre><code>## Source: local data frame [7 x 3]
## 
##              ComplaintType         CreatedDate      City
## 1         Derelict Vehicle 2014-11-16 23:46:57 RIDGEWOOD
## 2       Noise - Commercial 2014-11-16 23:46:08   ASTORIA
## 3        Derelict Vehicles 2014-11-16 23:46:00   Jamaica
## 4 Benefit Card Replacement 2014-11-16 23:45:55          
## 5         Blocked Driveway 2014-11-16 23:45:43  BROOKLYN
## 6       School Maintenance 2014-11-16 23:45:41     BRONX
## 7  Noise - Street/Sidewalk 2014-11-16 23:45:10  NEW YORK</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 2.058 | system: 0.977 | elapsed: 3.050</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_db %&gt;%
<span class="st">  </span><span class="kw">select</span>(ComplaintType, CreatedDate, City) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(CreatedDate &lt;<span class="st"> &quot;2014-11-16 23:47:00&quot;</span>,
         CreatedDate &gt;<span class="st"> &quot;2014-11-16 23:45:00&quot;</span>) %&gt;%
<span class="st">  </span>explain_and_eval</code></pre></div>
<pre><code>## &lt;SQL&gt;
## SELECT &quot;ComplaintType&quot; AS &quot;ComplaintType&quot;, &quot;CreatedDate&quot; AS &quot;CreatedDate&quot;, &quot;City&quot; AS &quot;City&quot;
## FROM &quot;data&quot;
## WHERE &quot;CreatedDate&quot; &lt; &#39;2014-11-16 23:47:00&#39; AND &quot;CreatedDate&quot; &gt; &#39;2014-11-16 23:45:00&#39;
## 
## 
## &lt;PLAN&gt;
##   selectid order from          detail
## 1        0     0    0 SCAN TABLE data</code></pre>
<pre><code>## NULL</code></pre>
<pre><code>## Source: sqlite 3.8.6 [noshare/service.sqlite]
## From: data [7 x 3]
## Filter: CreatedDate &lt; &quot;2014-11-16 23:47:00&quot;, CreatedDate &gt; &quot;2014-11-16
##   23:45:00&quot; 
## 
##              ComplaintType         CreatedDate      City
## 1         Derelict Vehicle 2014-11-16 23:46:57 RIDGEWOOD
## 2       Noise - Commercial 2014-11-16 23:46:08   ASTORIA
## 3        Derelict Vehicles 2014-11-16 23:46:00   Jamaica
## 4 Benefit Card Replacement 2014-11-16 23:45:55          
## 5         Blocked Driveway 2014-11-16 23:45:43  BROOKLYN
## 6       School Maintenance 2014-11-16 23:45:41     BRONX
## 7  Noise - Street/Sidewalk 2014-11-16 23:45:10  NEW YORK</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 1.899 | system: 0.903 | elapsed: 2.811</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dbGetQuery</span>(db, <span class="st">&quot;SELECT ComplaintType, CreatedDate, City</span>
<span class="st">                FROM data </span>
<span class="st">                WHERE CreatedDate &lt; &#39;2014-11-16 23:47:00&#39; </span>
<span class="st">                AND CreatedDate &gt; &#39;2014-11-16 23:45:00&#39;&quot;</span>)</code></pre></div>
<pre><code>##              ComplaintType         CreatedDate      City
## 1         Derelict Vehicle 2014-11-16 23:46:57 RIDGEWOOD
## 2       Noise - Commercial 2014-11-16 23:46:08   ASTORIA
## 3        Derelict Vehicles 2014-11-16 23:46:00   Jamaica
## 4 Benefit Card Replacement 2014-11-16 23:45:55          
## 5         Blocked Driveway 2014-11-16 23:45:43  BROOKLYN
## 6       School Maintenance 2014-11-16 23:45:41     BRONX
## 7  Noise - Street/Sidewalk 2014-11-16 23:45:10  NEW YORK</code></pre>
</div>
<h1 id="pull-out-the-hour-unit">Pull out the hour unit</h1>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 2.832 | system: 0.968 | elapsed: 3.819</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## `strftime` in R is too slow. Demonstrate its usage with the first
## 100,000 rows of the total over 9,000,000 rows.
service %&gt;%
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span>:<span class="dv">100000</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(CreatedDate, ComplaintType) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hour =</span> <span class="kw">strftime</span>(CreatedDate, <span class="st">&quot;%H&quot;</span>))</code></pre></div>
<pre><code>## Source: local data frame [100,000 x 3]
## 
##            CreatedDate              ComplaintType hour
## 1  2015-04-12 02:41:17           Street Condition   02
## 2  2015-04-12 02:08:53   Benefit Card Replacement   02
## 3  2015-04-12 02:08:40         Noise - Commercial   02
## 4  2015-04-12 02:08:24    Noise - Street/Sidewalk   02
## 5  2015-04-12 02:04:39         Noise - Commercial   02
## 6  2015-04-12 02:01:31    Noise - Street/Sidewalk   02
## 7  2015-04-12 02:00:35         Noise - Commercial   02
## 8  2015-04-12 01:59:14    Noise - Street/Sidewalk   01
## 9  2015-04-12 01:58:18 Homeless Person Assistance   01
## 10 2015-04-12 01:57:05         Noise - Commercial   01
## ..                 ...                        ...  ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(125, 214, 121)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(125, 214, 121)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(125, 214, 121)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(125, 214, 121)); /* Standard syntax; must be last */">user: 0.026 | system: 0.004 | elapsed: 0.037</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_db %&gt;%
<span class="st">  </span><span class="kw">select</span>(CreatedDate, ComplaintType) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hour =</span> <span class="kw">strftime</span>(<span class="st">&quot;%H&quot;</span>, CreatedDate)) %&gt;%
<span class="st">  </span>explain_and_eval %&gt;%
<span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>)</code></pre></div>
<pre><code>## &lt;SQL&gt;
## SELECT &quot;CreatedDate&quot; AS &quot;CreatedDate&quot;, &quot;ComplaintType&quot; AS &quot;ComplaintType&quot;, STRFTIME(&#39;%H&#39;, &quot;CreatedDate&quot;) AS &quot;hour&quot;
## FROM &quot;data&quot;
## 
## 
## &lt;PLAN&gt;
##   selectid order from          detail
## 1        0     0    0 SCAN TABLE data</code></pre>
<pre><code>## NULL</code></pre>
<pre><code>##           CreatedDate            ComplaintType hour
## 1 2015-04-12 02:41:17         Street Condition   02
## 2 2015-04-12 02:08:53 Benefit Card Replacement   02
## 3 2015-04-12 02:08:40       Noise - Commercial   02
## 4 2015-04-12 02:08:24  Noise - Street/Sidewalk   02
## 5 2015-04-12 02:04:39       Noise - Commercial   02</code></pre>
</div>
<p>The obove code only retrieve the first 5 rows. To compare speed fairly with the in-memory implementation, retrive the whole table with <code>collect</code>.</p>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 10.8 | system:  1.9 | elapsed: 12.8</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_db %&gt;%
<span class="st">  </span><span class="kw">select</span>(CreatedDate, ComplaintType) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hour =</span> <span class="kw">strftime</span>(<span class="st">&quot;%H&quot;</span>, CreatedDate)) %&gt;%
<span class="st">  </span>collect</code></pre></div>
<pre><code>## Source: local data frame [9,115,505 x 3]
## 
##            CreatedDate              ComplaintType hour
## 1  2015-04-12 02:41:17           Street Condition   02
## 2  2015-04-12 02:08:53   Benefit Card Replacement   02
## 3  2015-04-12 02:08:40         Noise - Commercial   02
## 4  2015-04-12 02:08:24    Noise - Street/Sidewalk   02
## 5  2015-04-12 02:04:39         Noise - Commercial   02
## 6  2015-04-12 02:01:31    Noise - Street/Sidewalk   02
## 7  2015-04-12 02:00:35         Noise - Commercial   02
## 8  2015-04-12 01:59:14    Noise - Street/Sidewalk   01
## 9  2015-04-12 01:58:18 Homeless Person Assistance   01
## 10 2015-04-12 01:57:05         Noise - Commercial   01
## ..                 ...                        ...  ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(123, 217, 123)); /* Standard syntax; must be last */">user: 0.006 | system: 0.000 | elapsed: 0.006</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dbGetQuery</span>(db, <span class="st">&quot;SELECT CreatedDate, </span>
<span class="st">               strftime(&#39;%H&#39;, CreatedDate) as hour, </span>
<span class="st">               ComplaintType </span>
<span class="st">               FROM data </span>
<span class="st">               LIMIT 5&quot;</span> )</code></pre></div>
<pre><code>##           CreatedDate hour            ComplaintType
## 1 2015-04-12 02:41:17   02         Street Condition
## 2 2015-04-12 02:08:53   02 Benefit Card Replacement
## 3 2015-04-12 02:08:40   02       Noise - Commercial
## 4 2015-04-12 02:08:24   02  Noise - Street/Sidewalk
## 5 2015-04-12 02:04:39   02       Noise - Commercial</code></pre>
</div>
<h1 id="count-complaints-by-hour">Count complaints by hour</h1>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(123, 217, 123)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(123, 217, 123)); /* Standard syntax; must be last */">user: 0.005 | system: 0.001 | elapsed: 0.005</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## function to pull out hour unit quickly.
get_hour &lt;-<span class="st"> </span>function(x) <span class="kw">substr</span>(x, <span class="dv">12</span>, <span class="dv">13</span>)</code></pre></div>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(205, 82, 46)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(205, 82, 46)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(205, 82, 46)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(205, 82, 46)); /* Standard syntax; must be last */">user: 1.138 | system: 0.105 | elapsed: 1.245</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(hour_count &lt;-<span class="st"> </span>service %&gt;%
<span class="st">   </span><span class="kw">mutate</span>(<span class="dt">hour =</span> <span class="kw">get_hour</span>(CreatedDate)) %&gt;%
<span class="st">   </span><span class="kw">count</span>(hour))</code></pre></div>
<pre><code>## Source: local data frame [24 x 2]
## 
##    hour       n
## 1    00 3535345
## 2    01   79480
## 3    02   61501
## 4    03   36823
## 5    04   33351
## 6    05   36708
## 7    06   78185
## 8    07  164346
## 9    08  286456
## 10   09  413486
## ..  ...     ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 15.94 | system:  3.32 | elapsed: 19.38</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_db %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hour =</span> <span class="kw">strftime</span>(<span class="st">&#39;%H&#39;</span>, CreatedDate)) %&gt;%
<span class="st">  </span><span class="kw">count</span>(hour) %&gt;%
<span class="st">  </span>explain_and_eval</code></pre></div>
<pre><code>## &lt;SQL&gt;
## SELECT &quot;hour&quot;, &quot;n&quot;
## FROM (SELECT &quot;hour&quot;, COUNT() AS &quot;n&quot;
## FROM (SELECT &quot;CreatedDate&quot;, &quot;ClosedDate&quot;, &quot;Agency&quot;, &quot;ComplaintType&quot;, &quot;Descriptor&quot;, &quot;City&quot;, STRFTIME(&#39;%H&#39;, &quot;CreatedDate&quot;) AS &quot;hour&quot;
## FROM &quot;data&quot;) AS &quot;_W5&quot;
## GROUP BY &quot;hour&quot;) AS &quot;_W6&quot;
## 
## 
## &lt;PLAN&gt;
##   selectid order from                       detail
## 1        0     0    0              SCAN TABLE data
## 2        0     0    0 USE TEMP B-TREE FOR GROUP BY</code></pre>
<pre><code>## NULL</code></pre>
<pre><code>## Source: sqlite 3.8.6 [noshare/service.sqlite]
## From: &lt;derived table&gt; [?? x 2]
## 
##    hour       n
## 1    00 3535345
## 2    01   79480
## 3    02   61501
## 4    03   36823
## 5    04   33351
## 6    05   36708
## 7    06   78185
## 8    07  164346
## 9    08  286456
## 10   09  413486
## ..  ...     ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 17.78 | system:  3.45 | elapsed: 21.36</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dbGetQuery</span>(db, <span class="st">&quot;SELECT CreatedDate, </span>
<span class="st">               strftime(&#39;%H&#39;, CreatedDate) as hour, </span>
<span class="st">               count(*) as `Complaints per Hour`</span>
<span class="st">               FROM data</span>
<span class="st">               GROUP BY hour&quot;</span> )</code></pre></div>
<pre><code>##            CreatedDate hour Complaints per Hour
## 1  2003-02-26 00:47:27   00             3535345
## 2  2003-02-26 01:36:31   01               79480
## 3  2003-03-04 02:00:46   02               61501
## 4  2003-02-25 03:07:01   03               36823
## 5  2003-03-04 04:32:11   04               33351
## 6  2003-03-06 05:43:57   05               36708
## 7  2003-03-01 06:48:02   06               78185
## 8  2003-02-26 07:23:54   07              164346
## 9  2003-02-25 08:28:37   08              286456
## 10 2003-02-24 09:20:06   09              413486
## 11 2003-02-24 10:02:31   10              472540
## 12 2003-02-24 11:27:32   11              474694
## 13 2003-02-24 12:03:24   12              381107
## 14 2003-02-24 13:37:36   13              439893
## 15 2003-02-24 14:17:16   14              450740
## 16 2003-02-24 15:39:02   15              405879
## 17 2003-02-24 16:25:43   16              340687
## 18 2003-02-24 17:17:16   17              263617
## 19 2003-02-24 18:00:41   18              256914
## 20 2003-02-24 19:04:44   19              221953
## 21 2003-02-24 20:12:45   20              186130
## 22 2003-02-25 21:53:25   21              178704
## 23 2003-02-24 22:02:20   22              169349
## 24 2003-02-25 23:11:24   23              147617</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(152, 170, 96)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(152, 170, 96)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(152, 170, 96)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(152, 170, 96)); /* Standard syntax; must be last */">user: 0.398 | system: 0.036 | elapsed: 0.440</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(hour_count, <span class="kw">aes</span>(<span class="dt">x =</span> hour, <span class="dt">y =</span> n)) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;#01AFE1&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#01AFE1&quot;</span>)</code></pre></div>
<div class="figure">
<img src="/articles/00050-311-service/figure/plot_complaint_by_hour_large_0-1.png" alt="plot of chunk plot_complaint_by_hour_large_0" />
<p class="caption">plot of chunk plot_complaint_by_hour_large_0</p>
</div>
</div>
<p>The count of hour 0 is unusually large. Let’s check their values.</p>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(221, 55, 31)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(221, 55, 31)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(221, 55, 31)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(221, 55, 31)); /* Standard syntax; must be last */">user: 1.364 | system: 0.094 | elapsed: 1.492</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hour =</span> <span class="kw">get_hour</span>(CreatedDate)) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(hour ==<span class="st"> &quot;00&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(CreatedDate, ClosedDate, hour)</code></pre></div>
<pre><code>## Source: local data frame [3,535,345 x 3]
## 
##            CreatedDate          ClosedDate hour
## 1  2015-04-12 00:58:57                  NA   00
## 2  2015-04-12 00:58:07                  NA   00
## 3  2015-04-12 00:57:52                  NA   00
## 4  2015-04-12 00:57:20                  NA   00
## 5  2015-04-12 00:56:55 2015-04-12 01:32:43   00
## 6  2015-04-12 00:55:56                  NA   00
## 7  2015-04-12 00:55:09                  NA   00
## 8  2015-04-12 00:53:10                  NA   00
## 9  2015-04-12 00:53:07 2015-04-12 01:08:43   00
## 10 2015-04-12 00:53:02                  NA   00
## ..                 ...                 ...  ...</code></pre>
</div>
<p>Nothing suspicious so far. Let’s check some random sample instead.</p>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(214, 67, 38)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(214, 67, 38)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(214, 67, 38)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(214, 67, 38)); /* Standard syntax; must be last */">user: 1.301 | system: 0.081 | elapsed: 1.385</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">2015</span>)
service %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hour =</span> <span class="kw">get_hour</span>(CreatedDate)) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(hour ==<span class="st"> &quot;00&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(CreatedDate, ClosedDate, hour) %&gt;%
<span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">25</span>)</code></pre></div>
<pre><code>## Source: local data frame [25 x 3]
## 
##            CreatedDate          ClosedDate hour
## 1  2015-01-11 00:00:00 2015-01-12 00:00:00   00
## 2  2010-11-15 00:00:00 2010-12-09 00:00:00   00
## 3  2013-10-29 00:00:00 2013-10-31 00:00:00   00
## 4  2015-02-18 00:00:00 2015-02-18 00:00:00   00
## 5  2014-08-28 00:00:00                  NA   00
## 6  2013-06-05 00:00:00 2013-06-24 00:00:00   00
## 7  2012-08-28 00:00:00 2012-08-30 00:00:00   00
## 8  2014-12-19 00:00:00 2014-12-23 00:00:00   00
## 9  2011-10-28 00:00:00 2011-11-02 00:00:00   00
## 10 2012-07-27 00:00:00 2012-08-10 00:00:00   00
## ..                 ...                 ...  ...</code></pre>
</div>
Those “00:00:00” must mean NA.
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 5.405 | system: 0.524 | elapsed: 6.064</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_fix_00 &lt;-<span class="st"> </span>service %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hour =</span>
           <span class="kw">ifelse</span>(<span class="kw">substring</span>(CreatedDate, <span class="dv">12</span>) ==<span class="st"> &quot;00:00:00&quot;</span>,
                  <span class="ot">NA</span>,
                  <span class="kw">get_hour</span>(CreatedDate)))</code></pre></div>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(159, 159, 90)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(159, 159, 90)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(159, 159, 90)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(159, 159, 90)); /* Standard syntax; must be last */">user: 0.386 | system: 0.113 | elapsed: 0.544</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hour_count_fix_00 &lt;-
<span class="st">    </span>service_fix_00 %&gt;%
<span class="st">      </span><span class="kw">count</span>(hour)</code></pre></div>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(162, 153, 86)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(162, 153, 86)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(162, 153, 86)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(162, 153, 86)); /* Standard syntax; must be last */">user: 0.501 | system: 0.057 | elapsed: 0.596</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="kw">na.omit</span>(hour_count_fix_00),
       <span class="kw">aes</span>(<span class="dt">x =</span> hour, <span class="dt">y =</span> n)) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;#01AFE1&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#01AFE1&quot;</span>)</code></pre></div>
<div class="figure">
<img src="/articles/00050-311-service/figure/plot_complaint_by_hour-1.png" alt="plot of chunk plot_complaint_by_hour" />
<p class="caption">plot of chunk plot_complaint_by_hour</p>
</div>
</div>
<h1 id="filter-noise-complaints-by-hour">Filter noise complaints by hour</h1>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 8.111 | system: 0.467 | elapsed: 8.614</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(noise_hour_count &lt;-<span class="st"> </span>
<span class="st">    </span>service_fix_00 %&gt;%
<span class="st">      </span><span class="kw">filter</span>(<span class="kw">grepl</span>(<span class="st">&quot;.*Noise.*&quot;</span>, ComplaintType, <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>)) %&gt;%
<span class="st">      </span><span class="kw">count</span>(hour))</code></pre></div>
<pre><code>## Source: local data frame [25 x 2]
## 
##    hour     n
## 1    00 47414
## 2    01 39384
## 3    02 26179
## 4    03 15956
## 5    04 12267
## 6    05  8101
## 7    06  9293
## 8    07 12495
## 9    08 16095
## 10   09 18456
## ..  ...   ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 3.65 | system: 1.08 | elapsed: 4.78</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_db %&gt;%
<span class="st">  </span><span class="kw">filter</span>(ComplaintType %LIKE%<span class="st"> &quot;%Noise%&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hour =</span> <span class="kw">strftime</span>(<span class="st">&#39;%H&#39;</span>, CreatedDate)) %&gt;%
<span class="st">  </span><span class="kw">count</span>(hour) %&gt;%
<span class="st">  </span>explain_and_eval</code></pre></div>
<pre><code>## &lt;SQL&gt;
## SELECT &quot;hour&quot;, &quot;n&quot;
## FROM (SELECT &quot;hour&quot;, COUNT() AS &quot;n&quot;
## FROM (SELECT &quot;CreatedDate&quot;, &quot;ClosedDate&quot;, &quot;Agency&quot;, &quot;ComplaintType&quot;, &quot;Descriptor&quot;, &quot;City&quot;, STRFTIME(&#39;%H&#39;, &quot;CreatedDate&quot;) AS &quot;hour&quot;
## FROM &quot;data&quot;
## WHERE &quot;ComplaintType&quot; LIKE &#39;%Noise%&#39;) AS &quot;_W7&quot;
## GROUP BY &quot;hour&quot;) AS &quot;_W8&quot;
## 
## 
## &lt;PLAN&gt;
##   selectid order from                       detail
## 1        0     0    0              SCAN TABLE data
## 2        0     0    0 USE TEMP B-TREE FOR GROUP BY</code></pre>
<pre><code>## NULL</code></pre>
<pre><code>## Source: sqlite 3.8.6 [noshare/service.sqlite]
## From: &lt;derived table&gt; [?? x 2]
## 
##    hour     n
## 1    00 47745
## 2    01 39384
## 3    02 26179
## 4    03 15956
## 5    04 12267
## 6    05  8101
## 7    06  9293
## 8    07 12495
## 9    08 16095
## 10   09 18456
## ..  ...   ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 3.81 | system: 1.06 | elapsed: 4.90</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dbGetQuery</span>(db, <span class="st">&quot;SELECT </span>
<span class="st">               strftime(&#39;%H&#39;, CreatedDate) as hour, </span>
<span class="st">               count(*) as `Complaints per Hour`</span>
<span class="st">               FROM data</span>
<span class="st">               WHERE ComplaintType LIKE &#39;%Noise%&#39;</span>
<span class="st">               AND NOT CreatedDate LIKE &#39;% 00:00:00&#39;</span>
<span class="st">               GROUP BY hour&quot;</span> )</code></pre></div>
<pre><code>##    hour Complaints per Hour
## 1    00               47414
## 2    01               39384
## 3    02               26179
## 4    03               15956
## 5    04               12267
## 6    05                8101
## 7    06                9293
## 8    07               12495
## 9    08               16095
## 10   09               18456
## 11   10               17690
## 12   11               16956
## 13   12               16184
## 14   13               16614
## 15   14               17093
## 16   15               17491
## 17   16               17415
## 18   17               17541
## 19   18               20226
## 20   19               23005
## 21   20               29349
## 22   21               37361
## 23   22               51046
## 24   23               59726</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(162, 153, 86)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(162, 153, 86)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(162, 153, 86)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(162, 153, 86)); /* Standard syntax; must be last */">user: 0.545 | system: 0.043 | elapsed: 0.595</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(noise_hour_count,
       <span class="kw">aes</span>(<span class="dt">x =</span> hour, <span class="dt">y =</span> n)) +
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Number of complaints&quot;</span>) +<span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> <span class="kw">comma_format</span>()) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;#01AFE1&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#01AFE1&quot;</span>)</code></pre></div>
<div class="figure">
<img src="/articles/00050-311-service/figure/plot_noise_hour-1.png" alt="plot of chunk plot_noise_hour" />
<p class="caption">plot of chunk plot_noise_hour</p>
</div>
</div>
<h1 id="segregate-complaints-by-hour">Segregate complaints by hour</h1>
Count complatins by 15 minute interval
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(165, 148, 84)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(165, 148, 84)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(165, 148, 84)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(165, 148, 84)); /* Standard syntax; must be last */">user: 0.590 | system: 0.038 | elapsed: 0.640</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(complaints_type_hour &lt;-<span class="st"> </span>
<span class="st">    </span>service_fix_00 %&gt;%
<span class="st">      </span><span class="kw">count</span>(ComplaintType, hour) %&gt;%
<span class="st">      </span><span class="kw">filter</span>(ComplaintType %in%<span class="st"> </span>type_top) %&gt;%
<span class="st">      </span><span class="kw">mutate</span>(<span class="kw">factor</span>(ComplaintType, type_top)))</code></pre></div>
<pre><code>## Source: local data frame [329 x 4]
## Groups: ComplaintType
## 
##       ComplaintType hour     n factor(ComplaintType, type_top)
## 1  Blocked Driveway   00  8395                Blocked Driveway
## 2  Blocked Driveway   01  6285                Blocked Driveway
## 3  Blocked Driveway   02  3952                Blocked Driveway
## 4  Blocked Driveway   03  3196                Blocked Driveway
## 5  Blocked Driveway   04  3267                Blocked Driveway
## 6  Blocked Driveway   05  4575                Blocked Driveway
## 7  Blocked Driveway   06  8588                Blocked Driveway
## 8  Blocked Driveway   07 15125                Blocked Driveway
## 9  Blocked Driveway   08 19484                Blocked Driveway
## 10 Blocked Driveway   09 19868                Blocked Driveway
## ..              ...  ...   ...                             ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(170, 141, 79)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(170, 141, 79)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(170, 141, 79)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(170, 141, 79)); /* Standard syntax; must be last */">user: 0.637 | system: 0.068 | elapsed: 0.711</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="kw">na.omit</span>(complaints_type_hour),
       <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(hour), <span class="dt">y =</span> n, <span class="dt">fill =</span> ComplaintType, <span class="dt">order =</span> -<span class="kw">as.numeric</span>(ComplaintType))) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">position =</span> <span class="st">&quot;stack&quot;</span>) +
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Number of complaints&quot;</span>) +
<span class="st">  </span><span class="kw">scale_fill_discrete</span>(<span class="dt">h =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">360</span> *<span class="st"> </span><span class="dv">5</span> )) +
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> <span class="kw">comma_format</span>()) +
<span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>)</code></pre></div>
<div class="figure">
<img src="/articles/00050-311-service/figure/plot_hour_type-1.png" alt="plot of chunk plot_hour_type" />
<p class="caption">plot of chunk plot_hour_type</p>
</div>
</div>
<h1 id="complaints-per-15-minute-interval">Complaints per 15 minute interval</h1>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 5.624 | system: 0.209 | elapsed: 5.850</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">get_interval &lt;-<span class="st"> </span>function(datetime) {
    minute_interval &lt;-
<span class="st">        </span><span class="kw">floor</span>(<span class="kw">as.numeric</span>(<span class="kw">substr</span>(datetime, <span class="dv">15</span>, <span class="dv">16</span>)) /<span class="st"> </span><span class="dv">15</span>) *<span class="st"> </span><span class="dv">15</span>
    <span class="kw">paste</span>(<span class="kw">substr</span>(datetime, <span class="dv">12</span>, <span class="dv">13</span>),   <span class="co">#hour</span>
          <span class="kw">sprintf</span>(<span class="st">&quot;%02i&quot;</span>, minute_interval), <span class="dt">sep =</span> <span class="st">&quot;:&quot;</span>)
}
service_interval &lt;-<span class="st"> </span>
<span class="st">    </span>service_fix_00 %&gt;%
<span class="st">      </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(hour)) %&gt;%
<span class="st">      </span><span class="kw">mutate</span>(<span class="dt">day =</span> <span class="kw">substr</span>(CreatedDate, <span class="dv">1</span>, <span class="dv">10</span>),
             <span class="dt">interval =</span> <span class="kw">get_interval</span>(CreatedDate))</code></pre></div>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(124, 217, 122)); /* Standard syntax; must be last */">user: 0.009 | system: 0.002 | elapsed: 0.011</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_interval %&gt;%
<span class="st">  </span><span class="kw">select</span>(CreatedDate, day, interval)</code></pre></div>
<pre><code>## Source: local data frame [5,681,233 x 3]
## 
##            CreatedDate        day interval
## 1  2015-04-12 02:41:17 2015-04-12    02:30
## 2  2015-04-12 02:08:53 2015-04-12    02:00
## 3  2015-04-12 02:08:40 2015-04-12    02:00
## 4  2015-04-12 02:08:24 2015-04-12    02:00
## 5  2015-04-12 02:04:39 2015-04-12    02:00
## 6  2015-04-12 02:01:31 2015-04-12    02:00
## 7  2015-04-12 02:00:35 2015-04-12    02:00
## 8  2015-04-12 01:59:14 2015-04-12    01:45
## 9  2015-04-12 01:58:18 2015-04-12    01:45
## 10 2015-04-12 01:57:05 2015-04-12    01:45
## ..                 ...        ...      ...</code></pre>
</div>
<p>I don’t know how to interpret the bar chart in original post. Draw a heat map instead.</p>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(255, 0, 0)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(255, 0, 0)); /* Standard syntax; must be last */">user: 4.033 | system: 0.098 | elapsed: 4.167</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">service_interval_count &lt;-<span class="st"> </span>
<span class="st">    </span>service_interval %&gt;%
<span class="st">      </span><span class="kw">filter</span>(day &gt;=<span class="st"> &quot;2015-01-01&quot;</span>, day &lt;=<span class="st"> &quot;2015-03-31&quot;</span>) %&gt;%
<span class="st">      </span><span class="kw">count</span>(day, interval) %&gt;%<span class="st"> </span>ungroup %&gt;%
<span class="st">      </span><span class="kw">mutate</span>(<span class="dt">day =</span> <span class="kw">as.Date</span>(day))

<span class="kw">ggplot</span>(service_interval_count,
       <span class="kw">aes</span>(<span class="kw">as.Date</span>(day), <span class="kw">as.POSIXlt</span>(interval, <span class="dt">format =</span> <span class="st">&quot;%H:%M&quot;</span>), <span class="dt">fill =</span> n)) +
<span class="st">  </span><span class="kw">geom_tile</span>() +<span class="st"> </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low=</span><span class="st">&quot;green&quot;</span>, <span class="dt">high=</span><span class="st">&quot;red&quot;</span>) +
<span class="st">  </span><span class="kw">scale_y_datetime</span>(<span class="dt">breaks =</span> <span class="kw">date_breaks</span>(<span class="st">&quot;2 hour&quot;</span>),
                   <span class="dt">labels =</span> <span class="kw">date_format</span>(<span class="st">&quot;%H:%M&quot;</span>)) +
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Date&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Time Interval&quot;</span>) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<div class="figure">
<img src="/articles/00050-311-service/figure/plot_interval_heatmap-1.png" alt="plot of chunk plot_interval_heatmap" />
<p class="caption">plot of chunk plot_interval_heatmap</p>
</div>
</div>
<p>The above plot is misleading. The white spots represent missing data, while missing from count table actually means 0, which should be colored as green.</p>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(124, 217, 122)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(124, 217, 122)); /* Standard syntax; must be last */">user: 0.009 | system: 0.001 | elapsed: 0.010</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(default_count &lt;-
<span class="st">    </span><span class="kw">local</span>({
        day &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">as.Date</span>(<span class="st">&quot;2015-01-01&quot;</span>), <span class="kw">as.Date</span>(<span class="st">&quot;2015-03-31&quot;</span>), <span class="dv">1</span>)
        interval &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="kw">rep</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%02i&quot;</span>, <span class="dv">0</span>:<span class="dv">23</span>), <span class="dt">each =</span> <span class="dv">4</span>),
                          <span class="kw">c</span>(<span class="st">&quot;00&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;30&quot;</span>, <span class="st">&quot;45&quot;</span>),
                          <span class="dt">sep =</span> <span class="st">&quot;:&quot;</span>)
        <span class="kw">as.tbl</span>(<span class="kw">data.frame</span>(<span class="dt">day =</span> <span class="kw">rep</span>(day, <span class="dt">each =</span> <span class="kw">length</span>(interval)),
                          <span class="dt">interval =</span> interval,
                          <span class="dt">default =</span> <span class="dv">0</span>,
                          <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>))
    }))</code></pre></div>
<pre><code>## Source: local data frame [8,640 x 3]
## 
##           day interval default
## 1  2015-01-01    00:00       0
## 2  2015-01-01    00:15       0
## 3  2015-01-01    00:30       0
## 4  2015-01-01    00:45       0
## 5  2015-01-01    01:00       0
## 6  2015-01-01    01:15       0
## 7  2015-01-01    01:30       0
## 8  2015-01-01    01:45       0
## 9  2015-01-01    02:00       0
## 10 2015-01-01    02:15       0
## ..        ...      ...     ...</code></pre>
</div>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(136, 197, 111)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(136, 197, 111)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(136, 197, 111)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(136, 197, 111)); /* Standard syntax; must be last */">user: 0.186 | system: 0.003 | elapsed: 0.190</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(service_interval_count_full &lt;-<span class="st"> </span>
<span class="st">    </span>service_interval_count %&gt;%
<span class="st">      </span><span class="kw">full_join</span>(default_count) %&gt;%
<span class="st">      </span><span class="kw">mutate</span>(<span class="dt">n =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(n), default, n)))</code></pre></div>
<pre><code>## Joining by: c(&quot;day&quot;, &quot;interval&quot;)</code></pre>
<pre><code>## Source: local data frame [8,640 x 4]
## 
##           day interval  n default
## 1  2015-01-01    00:00 11       0
## 2  2015-01-01    00:15 16       0
## 3  2015-01-01    00:30 12       0
## 4  2015-01-01    00:45 15       0
## 5  2015-01-01    01:00 15       0
## 6  2015-01-01    01:15 20       0
## 7  2015-01-01    01:30  6       0
## 8  2015-01-01    01:45 16       0
## 9  2015-01-01    02:00 15       0
## 10 2015-01-01    02:15 13       0
## ..        ...      ... ..     ...</code></pre>
</div>
<p>I use <code>full_join</code> here, and check the number of rows is the same as the rows of <code>default_count</code>, ensuring my code is correct.</p>
<div class="code_chunk">
<pre class = time style="background-image: -webkit-linear-gradient(left, rgb(123, 218, 123), rgb(188, 110, 62)); /* For Chrome 25 and Safari 6, iOS 6.1, Android 4.3 */
  background-image:    -moz-linear-gradient(left, rgb(123, 218, 123), rgb(188, 110, 62)); /* For Firefox (3.6 to 15) */
  background-image:      -o-linear-gradient(left, rgb(123, 218, 123), rgb(188, 110, 62)); /* For old Opera (11.1 to 12.0) */ 
  background-image:         linear-gradient(to right, rgb(123, 218, 123), rgb(188, 110, 62)); /* Standard syntax; must be last */">user: 0.929 | system: 0.046 | elapsed: 0.989</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(service_interval_count_full,
       <span class="kw">aes</span>(<span class="kw">as.Date</span>(day), <span class="kw">as.POSIXlt</span>(interval, <span class="dt">format =</span> <span class="st">&quot;%H:%M&quot;</span>), <span class="dt">fill =</span> n)) +
<span class="st">  </span><span class="kw">geom_tile</span>() +<span class="st"> </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low=</span><span class="st">&quot;green&quot;</span>, <span class="dt">high=</span><span class="st">&quot;red&quot;</span>) +
<span class="st">  </span><span class="kw">scale_y_datetime</span>(<span class="dt">breaks =</span> <span class="kw">date_breaks</span>(<span class="st">&quot;2 hour&quot;</span>),
                   <span class="dt">labels =</span> <span class="kw">date_format</span>(<span class="st">&quot;%H:%M&quot;</span>)) +
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Date&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;15 Minutes Time Interval&quot;</span>) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<div class="figure">
<img src="/articles/00050-311-service/figure/plot_interval_heatmap_no_na-1.png" alt="plot of chunk plot_interval_heatmap_no_na" />
<p class="caption">plot of chunk plot_interval_heatmap_no_na</p>
</div>
</div>
<h1 id="session-info">Session info</h1>
Print session info for the good of reproducibility.
<div class="code_chunk">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">session_info</span>()</code></pre></div>
<pre><code>## Session info --------------------------------------------------------------</code></pre>
<pre><code>##  setting  value                       
##  version  R version 3.2.0 (2015-04-16)
##  system   x86_64, darwin13.4.0        
##  ui       X11                         
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  tz       America/Chicago</code></pre>
<pre><code>## Packages ------------------------------------------------------------------</code></pre>
<pre><code>##  package    * version    date       source                          
##  assertthat * 0.1        2013-12-06 CRAN (R 3.2.0)                  
##  codetools  * 0.2-11     2015-03-10 CRAN (R 3.2.0)                  
##  colorspace * 1.2-6      2015-03-11 CRAN (R 3.2.0)                  
##  DBI          0.3.1      2014-09-24 CRAN (R 3.2.0)                  
##  devtools   * 1.7.0.9000 2015-04-24 Github (hadley/devtools@8be6b72)
##  digest     * 0.6.8      2014-12-31 CRAN (R 3.2.0)                  
##  dplyr        0.4.1      2015-01-14 CRAN (R 3.2.0)                  
##  evaluate   * 0.7        2015-04-21 CRAN (R 3.2.0)                  
##  formatR    * 1.2        2015-04-21 CRAN (R 3.2.0)                  
##  ggplot2      1.0.1      2015-03-17 CRAN (R 3.2.0)                  
##  gtable     * 0.1.2      2012-12-05 CRAN (R 3.2.0)                  
##  knitr        1.9        2015-01-20 CRAN (R 3.2.0)                  
##  labeling   * 0.3        2014-08-23 CRAN (R 3.2.0)                  
##  lazyeval   * 0.1.10     2015-01-02 CRAN (R 3.2.0)                  
##  magrittr   * 1.5        2014-11-22 CRAN (R 3.2.0)                  
##  MASS       * 7.3-40     2015-03-21 CRAN (R 3.2.0)                  
##  munsell    * 0.4.2      2013-07-11 CRAN (R 3.2.0)                  
##  plyr         1.8.2      2015-04-21 CRAN (R 3.2.0)                  
##  proto      * 0.3-10     2012-12-22 CRAN (R 3.2.0)                  
##  R6         * 2.0.1      2014-10-29 CRAN (R 3.2.0)                  
##  Rcpp       * 0.11.5     2015-03-06 CRAN (R 3.2.0)                  
##  readr        0.1.0      2015-04-09 CRAN (R 3.2.0)                  
##  reshape2   * 1.4.1      2014-12-06 CRAN (R 3.2.0)                  
##  RSQLite    * 1.0.0      2014-10-25 CRAN (R 3.2.0)                  
##  rstudioapi * 0.3.1      2015-04-07 CRAN (R 3.2.0)                  
##  scales       0.2.4      2014-04-22 CRAN (R 3.2.0)                  
##  stringr    * 0.6.2      2012-12-06 CRAN (R 3.2.0)</code></pre>
</div>


                                        <!--  disqus  -->
                                        <div id="disqus_thread"></div>
                                        <script type="text/javascript">
                                          /* * * CONFIGURATION VARIABLES * * */
                                          var disqus_shortname = 'luckyrandom-blog';
                                          var disqus_identifier = '/blog/articles/00050-311-service/';
                                          /* * * DON'T EDIT BELOW THIS LINE * * */
                                          (function() {
                                          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                                          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                                          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                                          })();
                                        </script>
                                        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
				</div>
			</div>
		</div>

                
      </div>
    </div>
    <footer>
      <div class="content-wrap">
        
        <section class="about">
          

        </section>
        <section class="copy">
          <p> &copy; 2014 Chenliang Xu &mdash; powerd by &nbsp;
            <a href='https://github.com/jnordberg/wintersmith'> Wintersmith </a>
          </p>
        </section>
        
      </div>
    </footer>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-62238615-2', 'auto');
  ga('send', 'pageview');
</script>
  </body>
</html>
